<!DOCTYPE html>
<html lang="ko-kr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <title>
    두께측정으로 알아보는 통계량(I) | gglee Blog
    
  </title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="stylesheet" href="/css/fonts.css" />
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/github.min.css" rel="stylesheet">

</head>

<body>
  <header>
    <div class="site-max-width">
      <div class="header-container">
        <div class="banner">
<a href="/" class="text">
&gfr;&gfr;&lfr;&efr;&efr; &Bfr;&lfr;&ofr;&gfr;

</a>
</div>

        <div class="header-meta">
          
          
          <span class="header-meta-item1"><a href="/">&larr; Home</a></span>
            
          <span class="date header-meta-item2">2020-04-12</span>
            

            
              
              
                
              
              
              
            
          <span class="header-meta-item3"></span>
              
            

          
          
        </div>
      </div>
    </div>
  </header>


<div class="site-max-width">
  <article class="article-container">
    <div class="article-meta">
      <span class="article-category">
        
        <a href="/categories/statistics">statistics</a>
        
      </span>
      <h1>두께측정으로 알아보는 통계량(I)</h1>

      
      <h3>gglee
</h3>
      

      

      
    </div>

    

    


<p>솔직히 말해서 난 통계는 좋아하지만, 수학은 별로 잘하지도 못한다. 데이터의 경향을 파악하고 모델을 세우는 것은 좋아하고 잘 따라가는 편이지만, 그 기반이 되는 수식은 머리속에 정확한 개념을 잡는데 매우 긴 시간이 걸린다. 한마디로, 추상화가 약하고 대신에 구체화가 강한 편.</p>
<p>손에 와닿는 예제를 위해서 철판의 두께를 측정하는 경우를 생각해 보자. 가로 1 m, 세로 1 m 두께, 10 mm 인 철판이 있다. 두께 측정방법은 초음파탐상측정법을 사용하였고, 캘리브레이션이 다 끝나서 재기만 하면 두께가 mm로 환산되어 나온다고 가정하자. 만일 각 변의 길이에 따라 1 cm 간격으로 측정하면 100 * 100 = 10000 개의 위치에서 데이터를 취득하게 된다 (당연히 실제로는 불가능)</p>
<p>이를 R로 모사해 보자. 일단 기본 패키지를 로드</p>
<pre class="r"><code>library(tidyverse)
library(gridExtra)    # 여러장 그림 합치기용 </code></pre>
<p>시물레이션을 위한 함수를 다음과 같이 정의.</p>
<pre class="r"><code>rnorm_simulation &lt;- function(mu, sigma, n_sample, n_test = 10000, seed = NULL) {
  if (!is.null(seed)) set.seed(seed)
  m_list &lt;- vector(&quot;double&quot;, n_test)
  s_list &lt;- vector(&quot;double&quot;, n_test)
  v_list &lt;- vector(&quot;double&quot;, n_test)
  for (i in 1:n_test) {
    a_sample &lt;- rnorm(n_sample, mean = mu, sd = sigma)
    m_list[[i]] &lt;- mean(a_sample)
    s_list[[i]] &lt;- sd(a_sample)
    v_list[[i]] &lt;- var(a_sample)
  }
  tibble(
    n_sample = n_sample, 
    sample_mean = m_list, 
    sample_sd = s_list, 
    sample_var = v_list)  
}</code></pre>
<p>두께와 초음파 측정 한계를 설정 .</p>
<pre class="r"><code>mu &lt;- 10        # thickness average
sigma &lt;- 0.03   # 초음파측정의 표준편차, 임의의 값
# var &lt;- 0.00009 # sigma^2 </code></pre>
<div id="철판-평균-두께-1회-측정" class="section level2">
<h2>1. 철판 평균 두께 1회 측정</h2>
<p>각 grid 위치별로 1번만 잰다고 가정해 보자.</p>
<pre class="r"><code>df &lt;- rnorm_simulation(mu = mu, sigma = sigma, n_sample = 1, seed = 22)
df</code></pre>
<pre><code>## # A tibble: 10,000 x 4
##    n_sample sample_mean sample_sd sample_var
##       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1        1        9.98        NA         NA
##  2        1       10.1         NA         NA
##  3        1       10.0         NA         NA
##  4        1       10.0         NA         NA
##  5        1        9.99        NA         NA
##  6        1       10.1         NA         NA
##  7        1       10.0         NA         NA
##  8        1       10.0         NA         NA
##  9        1        9.99        NA         NA
## 10        1       10.0         NA         NA
## # … with 9,990 more rows</code></pre>
<p>한번만 측정했기 때문에, 각 위치별 sd, var가 당연히 없다. mean은 한번만 측정했으니 그값이 그대로 평균값으로 결정된다.</p>
<p>이때, 전체 철판의 통계량은,</p>
<pre class="r"><code>df %&gt;%
  summarise(
    mean = mean(sample_mean), 
    sd = sd(sample_mean), 
    var = var(sample_mean)
)</code></pre>
<pre><code>## # A tibble: 1 x 3
##    mean     sd      var
##   &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;
## 1  10.0 0.0302 0.000911</code></pre>
<pre class="r"><code>df %&gt;% ggplot(aes(sample_mean)) + 
  geom_histogram(color = &quot;black&quot;, fill = &quot;white&quot;)</code></pre>
<p><img src="/post/2020-04-12-standard-deviation-vs-error_files/figure-html/unnamed-chunk-7-1.png" width="672" /></p>
<p>최초에 세팅한 값 그대로 잘 나온다. 근데 이건 잘 해석해야 할 것이, 원래 철판 전체의 두께가 10 mm 였는데, 전체 측정한 철판의 평균이 그것에 맞춰서 나온 것이고, 측정 한계 만큼 표준편차가 발생하였다는 의미. 즉 한 포인트만으로 계산해 보면, 9.90, 10.10 mm 가 나오는 위치도 존재한다는 의미이다. 초음파 표준편차가 0.03 mm인데, 오차가 0.10 mm나 나온다고? 10000번 측정하다 보면 충분히 가능한 이야기… (정규분포에서 3sd 이상인 경우)</p>
</div>
<div id="위치별-측정-횟수-영향" class="section level2">
<h2>2. 위치별 측정 횟수 영향</h2>
<p>한 그리드 위치에서 3번 또는 30번을 측정한다고 가정해 보자. 한 위치에서 반복 측정했으니 그 위치에서 정밀성은 높아진다.</p>
<pre class="r"><code>df1 &lt;- rnorm_simulation(mu = mu, sigma = sigma, n_sample = 3, seed = 22)
df2 &lt;- rnorm_simulation(mu = mu, sigma = sigma, n_sample = 10, seed = 22)
df3 &lt;- rnorm_simulation(mu = mu, sigma = sigma, n_sample = 30, seed = 22)
df &lt;- bind_rows(df1, df2, df3)
df</code></pre>
<pre><code>## # A tibble: 30,000 x 4
##    n_sample sample_mean sample_sd sample_var
##       &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
##  1        3       10.0    0.0450  0.00202   
##  2        3       10.0    0.0323  0.00105   
##  3        3       10.0    0.00207 0.00000430
##  4        3       10.0    0.0169  0.000284  
##  5        3       10.0    0.0231  0.000532  
##  6        3       10.0    0.0442  0.00196   
##  7        3        9.99   0.0385  0.00148   
##  8        3        9.98   0.0159  0.000253  
##  9        3       10.0    0.0170  0.000290  
## 10        3        9.98   0.0369  0.00137   
## # … with 29,990 more rows</code></pre>
<p>각각의 통계량은 다음과 같다.</p>
<pre class="r"><code>df %&gt;%
  group_by(n_sample) %&gt;%
  summarize_all(mean)</code></pre>
<pre><code>## # A tibble: 2 x 4
##   n_sample sample_mean sample_sd sample_var
##      &lt;dbl&gt;       &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
## 1        3        10.0    0.0267   0.000903
## 2       30        10.0    0.0298   0.000901</code></pre>
<p>sample_sd는 n_sample = 3에서는 원래 값인 0.03에 못 미친다. 평균과 분산은 철판 본래의 값과 거의 일치. 즉 전체 철판의 평균과 분산은 각 위치에서 평균과 분산을 다시 평균한 값과 같지만, <strong>표준편차는 평균값이 일치하지 않는다</strong>. 각각의 정의와 수식을 고려해보면 당연한데, 언뜻 착각하기 쉬운 결과이므로 실제 적용에 주의가 필요하다.</p>
<p>그림으로 그려보면 이해가 빠르다.</p>
<pre class="r"><code>df %&gt;%
  pivot_longer(names_to = &quot;key&quot;, values_to = &quot;value&quot;, -n_sample) %&gt;%
  arrange(n_sample, key) %&gt;%
  ggplot(aes(x = factor(n_sample), y = value, group = n_sample, color = key)) +
  geom_violin() +
  geom_point(stat=&#39;summary&#39;, fun = &#39;mean&#39;) +
  facet_wrap(~key, scales = &quot;free&quot;) +
  theme(legend.position = &quot;none&quot;)</code></pre>
<p><img src="/post/2020-04-12-standard-deviation-vs-error_files/figure-html/unnamed-chunk-10-1.png" width="672" /></p>
<p><strong>표준편차만 불일치</strong>.</p>
<p>참고로 평균과 불확도(표준오차)를 수식으로 표현하면, 아래와 같다.</p>
<p><span class="math display">\[ \bar{Y} = \frac{1}{N} \sum_{i=1}^{N}{Y_i}\]</span>
<span class="math display">\[s(\bar{Y}) = \frac{1}{\sqrt{N(N-1)}} \sqrt{\sum_{i=1}^{N}{(Y_i - \bar{Y})^2}}\]</span></p>
</div>
<div id="철판의-두께가-달라지는-경우" class="section level2">
<h2>3. 철판의 두께가 달라지는 경우</h2>
<p>압연과정에서 잘못 만들어져서, 두께가 폭의 한쪽은 10 mm, 다른 쪽은 11 mm이라고 가정해 보자. 각 위치에서 3번씩 측정을 할 경우를 적절히 모사해 보면 다음과 같다. 사실, 이 코드는 이해를 돕기 위하여 조금 길게 쓴 것이다. 실제 결과는 하단에 주석으로 달아놓은 코드와 동일하다.</p>
<pre class="r"><code>n_sample &lt;- 3
thickness_real &lt;- rep(seq(10, 11, length.out = 100), each = 100)

list1 &lt;- list()
list2 &lt;- list()
list3 &lt;- list()
for (i in 1:length(thickness_real)) {
  list1[[i]] &lt;- rep(i, n_sample)
  list2[[i]] &lt;- rep(thickness_real[[i]], n_sample)
  list3[[i]] &lt;- rnorm(n_sample, mean = thickness_real[[i]], sd = sigma)
}
df1 &lt;- tibble(
  grid = unlist(list1),
  real = unlist(list2),
  measured = unlist(list3),
)
df1</code></pre>
<pre><code>## # A tibble: 30,000 x 3
##     grid  real measured
##    &lt;int&gt; &lt;dbl&gt;    &lt;dbl&gt;
##  1     1    10     9.91
##  2     1    10     9.99
##  3     1    10     9.97
##  4     2    10    10.0 
##  5     2    10     9.95
##  6     2    10    10.0 
##  7     3    10    10.0 
##  8     3    10    10.0 
##  9     3    10     9.98
## 10     4    10    10.0 
## # … with 29,990 more rows</code></pre>
<pre class="r"><code>## Alternative shortened code
# thickness_error &lt;- rnorm_simulation(
#   mu = 0, sigma = sigma, n_sample = 3, seed = 22, n_test = 10000
# )
# thickness_error$real &lt;- thickness_real
# df2 &lt;- thickness_error %&gt;%
#   mutate(sample_mean = sample_mean + real, grid = 1:n())</code></pre>
<pre class="r"><code>df1_summarized &lt;- df1 %&gt;%
  group_by(grid) %&gt;%
  summarize(
    n_sample = n(), 
    measured_mean = mean(measured),
    measured_sd = sd(measured),
    measured_var = var(measured),
  )
df1_summarized</code></pre>
<pre><code>## # A tibble: 10,000 x 5
##     grid n_sample measured_mean measured_sd measured_var
##    &lt;int&gt;    &lt;int&gt;         &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
##  1     1        3          9.96      0.0419     0.00176 
##  2     2        3          9.99      0.0362     0.00131 
##  3     3        3         10.0       0.0197     0.000387
##  4     4        3         10.0       0.0189     0.000357
##  5     5        3         10.0       0.0382     0.00146 
##  6     6        3         10.0       0.0207     0.000429
##  7     7        3          9.98      0.0298     0.000890
##  8     8        3         10.0       0.0476     0.00226 
##  9     9        3         10.0       0.0211     0.000443
## 10    10        3          9.97      0.0194     0.000377
## # … with 9,990 more rows</code></pre>
<p>전체 철판에 대한 결과를 다시 평균을 내보면,</p>
<pre class="r"><code>df1_summarized %&gt;%
  summarize_at(vars(starts_with(&quot;measured&quot;)), mean)</code></pre>
<pre><code>## # A tibble: 1 x 3
##   measured_mean measured_sd measured_var
##           &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
## 1          10.5      0.0267     0.000903</code></pre>
<p>그림으로 그리면,</p>
<pre class="r"><code>df1_summarized %&gt;%
  pivot_longer(starts_with(&quot;measured&quot;), names_to = &quot;key&quot;, values_to = &quot;value&quot;) %&gt;%
  arrange(key) %&gt;%
  select(-grid, -n_sample) %&gt;%
  ggplot(aes(value)) +
  geom_histogram(color = &quot;black&quot;, fill = &quot;white&quot;) +
  facet_wrap(~key, scales = &quot;free&quot;)</code></pre>
<p><img src="/post/2020-04-12-standard-deviation-vs-error_files/figure-html/unnamed-chunk-14-1.png" width="672" /></p>
<p>전체 철판 두께에 대해서는 평균의 분포가 박스형으로 바뀌었으나(10-11 mm사이에 균일 분포), 측정 위치별 분산은 변하지 않았다. 결국, 두께가 다른 경우에도, <strong>초음파 장비의 분산은 각 위치별 분산의 평균으로 계산할 수 있다</strong>.</p>
</div>
<div id="요약" class="section level2">
<h2>4. 요약</h2>
<ul>
<li>한 위치에서 측정 평균은 항상 참값에 가깝다.</li>
<li>측정 회수가 증가할수록 불확도 또는 표준오차, 즉 평균에서 벗어난 정도는 측정횟수에 <span class="math inline">\(1 / \sqrt{n}\)</span> 만큼 감소한다.</li>
<li>측정에 따라 발생하는 오차의 분산은 일정하게 유지된다.</li>
</ul>
</div>

    
    













<div class="post-footer">
  <span style="font-weight: bold;">Author says:</span><br />
  
  <span>미니멀 블로그에 오신 것을 환영합니다. 레트로 느낌을 좋아하신다면 만족하실 것입니다!</span>
  
</div>




    
    
  <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "gglee-netlify-com" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


    
<nav class="post-nav">
  <span style="text-align: left;"></span>
  <span style="text-align: right;"><a href="/post/2020/rstudio-rmd-setting/">RStudio에서 Rmd 파일 세팅 &rarr;</a></span>
</nav>


  </article>
</div>

<footer>
  
  <div class="site-max-width">
    <div class="footer-container">
      <ul class="site-menu">
        
        <li><a href="/"><span data-hover="Home">Home</span></a></li>
        
        <li><a href="/about/"><span data-hover="About">About</span></a></li>
        
        <li><a href="/categories/"><span data-hover="Categories">Categories</span></a></li>
        
        <li><a href="/tags/"><span data-hover="Tags">Tags</span></a></li>
        
        <li><a href="/archives/"><span data-hover="Archives">Archives</span></a></li>
        
      </ul>
      
      <span >© <a href="https://gglee.netlify.com">gglee</a> 2020 | <a href="https://github.com/gglee4ai">Github</a></span>
      
    </div>
  </div>
</footer>

<script async>
(function() {
  function center_el(tagName) {
    var tags = document.getElementsByTagName(tagName), i, tag;
    for (i = 0; i < tags.length; i++) {
      tag = tags[i];
      var parent = tag.parentElement;
      
      if (parent.childNodes.length === 1) {
        
        if (parent.nodeName === 'A') {
          parent = parent.parentElement;
          if (parent.childNodes.length != 1) continue;
          parent.firstChild.style.border = 'none';
        }
        if (parent.nodeName === 'P') parent.style.textAlign = 'center';
      }
    }
  }
  var tagNames = ['img', 'embed', 'object'];
  for (var i = 0; i < tagNames.length; i++) {
    center_el(tagNames[i]);
  }
})();
</script>


<script>
(function() {
  var i, text, code, codes = document.getElementsByTagName('code');
  for (i = 0; i < codes.length;) {
    code = codes[i];
    if (code.parentNode.tagName !== 'PRE' && code.childElementCount === 0) {
      text = code.textContent;
      if (/^\$[^$]/.test(text) && /[^$]\$$/.test(text)) {
        text = text.replace(/^\$/, '\\(').replace(/\$$/, '\\)');
        code.textContent = text;
      }
      if (/^\\\((.|\s)+\\\)$/.test(text) || /^\\\[(.|\s)+\\\]$/.test(text) ||
          /^\$(.|\s)+\$$/.test(text) ||
          /^\\begin\{([^}]+)\}(.|\s)+\\end\{[^}]+\}$/.test(text)) {
        code.outerHTML = code.innerHTML;  
        continue;
      }
    }
    i++;
  }
})();
</script>

<script async src="//mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML"></script>






<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
<script>
hljs.configure({languages: []});
hljs.initHighlightingOnLoad();
</script>



<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-162930875-1', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>
</html>
